{% extends "base/base.html" %}

{% load static %}

{% block title %}Cadastrar Conta Bancária{% endblock %}

{% block content %}

<div class="container">
    <div class="row align-items-center ms-2 me-3 mb-3 mt-3 justify-content-between">
        <div class="col-auto">
            {% if is_all_units_selected %}
                <h2 class="text-color-primary m-0">Cadastrar Conta Bancária <span class="fw-light">-> Todas as unidades</span></h2>
            {% else %}
                <h2 class="text-color-primary m-0">Cadastrar Conta Bancária <span class="fw-light">-> {{ selected_unit.name }}</span></h2>
            {% endif %}
        </div>
    </div>

    <!-- Formulário de Cadastro -->
    <div class="container-style">
        {% if is_all_units_selected %}
        <div class="row mb-3">
            <div class="col-12">
                <div class="alert alert-warning d-flex align-items-center justify-content-around m-0">
                    <i class="fa-solid fa-circle-exclamation me-2 fs-3"></i>
                    <div class="text-center">
                        <strong>Selecione uma unidade específica</strong><br>
                        <small>Para cadastrar uma conta bancária, você deve selecionar uma unidade específica da empresa.</small>
                    </div>
                    <i class="fa-solid fa-circle-exclamation ms-2 fs-3 "></i>
                </div>
            </div>
        </div>
        {% endif %}
        
        <form method="post" class="needs-validation" novalidate>
            {% csrf_token %}
            
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="bank_name" class="form-label fw-bold d-flex align-items-center">Nome do Banco:</label>
                    <input type="text" 
                           name="bank_name" 
                           id="bank_name" 
                           class="form-control" 
                           value="{{ form_data.bank_name|default:'' }}"
                           placeholder="Ex: Banco do Brasil, Itaú, Bradesco"
                           required>
                    <div class="invalid-feedback">
                        Por favor, informe o nome do banco.
                    </div>
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="name" class="form-label fw-bold d-flex align-items-center">Nome da Conta:</label>
                    <input type="text" 
                           name="name" 
                           id="name" 
                           class="form-control" 
                           value="{{ form_data.name|default:'' }}"
                           placeholder="Ex: Conta Principal, Conta Movimento"
                           required>
                    <div class="invalid-feedback">
                        Por favor, informe o nome da conta.
                    </div>
                </div>
            </div>

            <div class="row">

                <div class="col-md-6 mb-3">
                    <label for="agency" class="form-label fw-bold d-flex align-items-center">
                        <i class="bi bi-question-circle-fill me-1 small"
                           style="font-size: 12px;"
                           data-bs-toggle="tooltip"
                           data-bs-placement="top"
                           title="Número da agência bancária"
                           data-bs-custom-class="custom-tooltip">
                        </i>Agência:</label>
                    <input type="text" 
                           name="agency" 
                           id="agency" 
                           class="form-control" 
                           value="{{ form_data.agency|default:'' }}"
                           placeholder="Ex: 1234-5">
                </div>
                
                <div class="col-md-6 mb-3">
                    <label for="account_number" class="form-label fw-bold d-flex align-items-center">
                        <i class="bi bi-question-circle-fill me-1 small"
                           style="font-size: 12px;"
                           data-bs-toggle="tooltip"
                           data-bs-placement="top"
                           title="Número da conta bancária"
                           data-bs-custom-class="custom-tooltip">
                        </i>Número da Conta:</label>
                    <input type="text" 
                           name="account_number" 
                           id="account_number" 
                           class="form-control" 
                           value="{{ form_data.account_number|default:'' }}"
                           placeholder="Ex: 12345-6">
                </div>
            </div>

            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="account_type" class="form-label fw-bold d-flex align-items-center">Tipo de Conta:</label>
                    <select name="account_type" id="account_type" class="form-control">
                        {% for value, label in account_types %}
                            <option value="{{ value }}" {% if form_data.account_type == value %}selected{% endif %}>
                                {{ label }}
                            </option>
                        {% endfor %}
                    </select>
                </div>
                 <div class="col-md-6 mb-3">
                     <label for="initial_balance" class="form-label fw-bold d-flex align-items-center">
                         <i class="bi bi-question-circle-fill me-1 small"
                            style="font-size: 12px;"
                            data-bs-toggle="tooltip"
                            data-bs-placement="top"
                            title="Saldo inicial da conta. Deixe 0 se não souber"
                            data-bs-custom-class="custom-tooltip">
                         </i>Saldo Inicial (R$):</label>
                     <input type="number" 
                            name="initial_balance" 
                            id="initial_balance" 
                            class="form-control" 
                            value="{{ form_data.initial_balance|default:'0' }}"
                            step="0.01"
                            min="0"
                            placeholder="0,00">
                 </div>
             </div>

            <div class="row">
                <div class="col-12 mb-3">
                    <label for="description" class="form-label fw-bold d-flex align-items-center">
                        <i class="bi bi-question-circle-fill me-1 small"
                           style="font-size: 12px;"
                           data-bs-toggle="tooltip"
                           data-bs-placement="top"
                           title="Informações adicionais sobre a conta bancária"
                           data-bs-custom-class="custom-tooltip">
                        </i>Descrição:</label>
                    <textarea name="description" 
                              id="description" 
                              class="form-control" 
                              rows="3"
                              placeholder="Informações adicionais sobre a conta">{{ form_data.description|default:'' }}</textarea>
                </div>
            </div>

            <!-- Botões de ação -->
            <div class="row mt-4">
                <div class="col-12 text-end">
                    <a href="{% url 'dashboard_financeiro' %}" class="btn btn-secondary">
                        <i class="fa-solid fa-arrow-left"></i> Voltar
                    </a>
                    <button type="submit" class="btn btn-primary rounded" 
                            style="background-color: {{ enterprise.primary_color }}; border: none;"
                            {% if is_all_units_selected %}disabled{% endif %}>
                        <i class="fa-solid fa-check"></i> 
                        {% if is_all_units_selected %}
                            Cadastro Desabilitado
                        {% else %}
                            Salvar Conta
                        {% endif %}
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validação do formulário
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms).forEach(function(form) {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            form.classList.add('was-validated')
        }, false)
    })
})
</script>
{% endblock %}

{% endblock %} 