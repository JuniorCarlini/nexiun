{% extends "base/base.html" %}

{% load static %}

{% block title %}Editar Conta Bancária{% endblock %}

{% block content %}

<div class="container">
    <div class="row align-items-center ms-2 me-3 mb-3 mt-3 justify-content-between">
        <div class="col-auto">
            <h2 class="text-color-primary m-0">Editar Conta Bancária  <span class="fw-light">{{ account.name  }}</span></h2>
        </div>
    </div>

    <!-- Formulário de Edição -->
    <div class="container-style">
                    <form method="post" class="needs-validation" novalidate>
                        {% csrf_token %}
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="bank_name" class="form-label fw-bold d-flex align-items-center">Nome do Banco:</label>
                                <input type="text" 
                                       name="bank_name" 
                                       id="bank_name" 
                                       class="form-control" 
                                       value="{{ form_data.bank_name }}"
                                       placeholder="Ex: Banco do Brasil, Itaú, Bradesco"
                                       required>
                                <div class="invalid-feedback">
                                    Por favor, informe o nome do banco.
                                </div>
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="name" class="form-label fw-bold d-flex align-items-center">Nome da Conta:</label>
                                <input type="text" 
                                       name="name" 
                                       id="name" 
                                       class="form-control" 
                                       value="{{ form_data.name }}"
                                       placeholder="Ex: Conta Principal, Conta Movimento"
                                       required>
                                <div class="invalid-feedback">
                                    Por favor, informe o nome da conta.
                                </div>
                            </div>
                        </div>

                        <div class="row">                     
                            <div class="col-md-6 mb-3">
                                <label for="agency" class="form-label fw-bold d-flex align-items-center">
                                    <i class="bi bi-question-circle-fill me-1 small"
                                       style="font-size: 12px;"
                                       data-bs-toggle="tooltip"
                                       data-bs-placement="top"
                                       title="Número da agência bancária"
                                       data-bs-custom-class="custom-tooltip">
                                    </i>Agência:</label>
                                <input type="text" 
                                       name="agency" 
                                       id="agency" 
                                       class="form-control" 
                                       value="{{ form_data.agency }}"
                                       placeholder="Ex: 1234-5">
                            </div>
                            
                            <div class="col-md-6 mb-3">
                                <label for="account_number" class="form-label fw-bold d-flex align-items-center">
                                    <i class="bi bi-question-circle-fill me-1 small"
                                       style="font-size: 12px;"
                                       data-bs-toggle="tooltip"
                                       data-bs-placement="top"
                                       title="Número da conta bancária"
                                       data-bs-custom-class="custom-tooltip">
                                    </i>Número da Conta:</label>
                                <input type="text" 
                                       name="account_number" 
                                       id="account_number" 
                                       class="form-control" 
                                       value="{{ form_data.account_number }}"
                                       placeholder="Ex: 12345-6">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="account_type" class="form-label fw-bold d-flex align-items-center">Tipo de Conta:</label>
                                <select name="account_type" id="account_type" class="form-control">
                                    {% for value, label in account_types %}
                                        <option value="{{ value }}" 
                                                {% if form_data.account_type == value %}selected{% endif %}>
                                            {{ label }}
                                        </option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="initial_balance" class="form-label fw-bold d-flex align-items-center">
                                    <i class="bi bi-question-circle-fill me-1 small"
                                       style="font-size: 12px;"
                                       data-bs-toggle="tooltip"
                                       data-bs-placement="top"
                                       title="Atenção: Alterar o saldo inicial afetará o saldo atual da conta"
                                       data-bs-custom-class="custom-tooltip">
                                    </i>Saldo Inicial (R$):</label>
                                <input type="number" 
                                       name="initial_balance" 
                                       id="initial_balance" 
                                       class="form-control" 
                                       value="{{ form_data.initial_balance }}"
                                       step="0.01"
                                       min="0"
                                       placeholder="0,00">
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 mb-3">
                                <label for="description" class="form-label fw-bold d-flex align-items-center">
                                    <i class="bi bi-question-circle-fill me-1 small"
                                       style="font-size: 12px;"
                                       data-bs-toggle="tooltip"
                                       data-bs-placement="top"
                                       title="Informações adicionais sobre a conta bancária"
                                       data-bs-custom-class="custom-tooltip">
                                    </i>Descrição:</label>
                                <textarea name="description" 
                                          id="description" 
                                          class="form-control" 
                                          rows="3"
                                          placeholder="Informações adicionais sobre a conta">{{ form_data.description }}</textarea>
                            </div>
                        </div>

                        <!-- Informações adicionais -->
                        <div class="row mb-3">
                            <div class="col-12">
                                <div class="alert alert-info">
                                    <h6 class="mb-3">Informações da Conta</h6>
                                    <div class="row">
                                        <div class="col-md-4">
                                            <strong>Saldo Atual:</strong><br>
                                            <span class="h5 {% if account.get_current_balance >= 0 %}text-success{% else %}text-danger{% endif %}">
                                                R$ {{ account.get_current_balance|floatformat:2 }}
                                            </span>
                                        </div>
                                        <div class="col-md-4">
                                            <strong>Total de Transações:</strong><br>
                                            {{ account.transactions.count }}
                                        </div>
                                        <div class="col-md-4">
                                            <strong>Status:</strong><br>
                                            {% if account.is_active %}
                                                <span class="badge bg-success">Ativa</span>
                                            {% else %}
                                                <span class="badge bg-secondary">Inativa</span>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Botões de ação -->
                        <div class="row mt-4">
                            <div class="col-12 text-end">
                                <a href="{% url 'dashboard_financeiro' %}" class="btn btn-secondary">
                                    <i class="fa-solid fa-arrow-left"></i> Voltar
                                </a>
                                <button type="submit" class="btn btn-primary rounded" style="background-color: {{ enterprise.primary_color }}; border: none;">
                                    <i class="fa-solid fa-check"></i> Salvar Alterações
                                </button>
                            </div>
                        </div>
                    </form>
    </div>
</div>

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Validação do formulário
    var forms = document.querySelectorAll('.needs-validation')
    Array.prototype.slice.call(forms).forEach(function(form) {
        form.addEventListener('submit', function(event) {
            if (!form.checkValidity()) {
                event.preventDefault()
                event.stopPropagation()
            }
            form.classList.add('was-validated')
        }, false)
    })
})
</script>
{% endblock %}

<style>
.container-style {
    background-color: #ffffff;
    border-radius: 15px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    padding: 20px;
}

.text-color-primary {
    color: #16365f;
}

.form-label {
    color: #495057;
    font-size: 0.95rem;
}

.was-validated .form-control:valid {
    border-color: #28a745;
}

.was-validated .form-select:valid {
    border-color: #28a745;
}

.alert {
    border-radius: 10px;
}

.badge {
    font-size: 0.8rem;
}
</style>
{% endblock %} 